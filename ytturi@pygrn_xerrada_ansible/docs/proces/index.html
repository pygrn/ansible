



<!DOCTYPE html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Còpia al porta-retalls">
      
        <meta name="lang:clipboard.copied" content="Copiat al porta-retalls">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="Cap document coincideix">
      
        <meta name="lang:search.result.one" content="1 document coincident">
      
        <meta name="lang:search.result.other" content="# documents coincidents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../extra/pygrn.jpg">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Procés de realització - Taller d'Ansible - Documentació</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#taller-realitzacio-de-la-tasca" tabindex="1" class="md-skip">
        Salta el contingut
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Taller d'Ansible - Documentació" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Taller d'Ansible - Documentació
              </span>
              <span class="md-header-nav__topic">
                Procés de realització
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Escriu per a començar a cercar
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ytturi/pygrn_xerrada_ansible/" title="Ves al repositori" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ytturi/pygrn_xerrada_ansible
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Taller d'Ansible - Documentació
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ytturi/pygrn_xerrada_ansible/" title="Ves al repositori" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ytturi/pygrn_xerrada_ansible
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inici" class="md-nav__link">
      Inici
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../README/" title="Informació i Ajuda" class="md-nav__link">
      Informació i Ajuda
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Procés de realització
      </label>
    
    <a href="./" title="Procés de realització" class="md-nav__link md-nav__link--active">
      Procés de realització
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Taula de continguts</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#desplegament" title="Desplegament" class="md-nav__link">
    Desplegament
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passos-a-realitzar-en-la-tasca" title="Passos a realitzar en la tasca" class="md-nav__link">
    Passos a realitzar en la tasca
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tractament-de-peticions-https" title="Tractament de peticions HTTP/S" class="md-nav__link">
    Tractament de peticions HTTP/S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clonar-el-repositori" title="Clonar el repositori" class="md-nav__link">
    Clonar el repositori
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurar-python" title="Configurar Python" class="md-nav__link">
    Configurar Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-de-la-documentacio" title="Build de la documentació" class="md-nav__link">
    Build de la documentació
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actualitzacio-dels-fitxers-a-servir" title="Actualització dels fitxers a servir" class="md-nav__link">
    Actualització dels fitxers a servir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Taula de continguts</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#desplegament" title="Desplegament" class="md-nav__link">
    Desplegament
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passos-a-realitzar-en-la-tasca" title="Passos a realitzar en la tasca" class="md-nav__link">
    Passos a realitzar en la tasca
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tractament-de-peticions-https" title="Tractament de peticions HTTP/S" class="md-nav__link">
    Tractament de peticions HTTP/S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clonar-el-repositori" title="Clonar el repositori" class="md-nav__link">
    Clonar el repositori
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurar-python" title="Configurar Python" class="md-nav__link">
    Configurar Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-de-la-documentacio" title="Build de la documentació" class="md-nav__link">
    Build de la documentació
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actualitzacio-dels-fitxers-a-servir" title="Actualització dels fitxers a servir" class="md-nav__link">
    Actualització dels fitxers a servir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ytturi/pygrn_xerrada_ansible/edit/master/docs/proces.md" title="Edita aquesta pàgina" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="taller-realitzacio-de-la-tasca">Taller - Realització de la tasca</h1>
<p>Per tal de facilitar el procés, he extrapolat els processos que farem dins la tasca.</p>
<p>Si ho necessiteu, he afegit "Tips" que mostren quines comandes executariem en local.
Adicionalment, he afegit en cada pas alguns mòduls d'Ansible que us poden ser útils.</p>
<h2 id="desplegament">Desplegament</h2>
<p>El desplegament amb ansible és senzill. Símplement utilitzarem la següent comanda:</p>
<pre><code># Primer cal estar on hem configurat l'entorn
workon ansible
cd ~/projectes/pygrn_ansible

# Fem correr la tasca per un inventari en concret
ansible-playbook tasks/deploy_docs.yml -i inventory.yml
</code></pre>

<h2 id="passos-a-realitzar-en-la-tasca">Passos a realitzar en la tasca</h2>
<h3 id="tractament-de-peticions-https">Tractament de peticions HTTP/S</h3>
<p>Posarem un Nginx amb la configuració facilitada en el repositori de la xerrada:</p>
<blockquote>
<p>pygrn_xerrada_ansible/taller/docs_nginx.conf</p>
</blockquote>
<p>Per tal de desplegar-ho, hem de pensar les passes que seguiriem en local i adaptar-ho a Ansible.</p>
<details class="note"><summary>Passes que seguiriem en local</summary><ol><li>Instalar Nginx amb <code>apt-get install nginx</code> </li><li>(<strong>opcional</strong>) Eliminar la configuració per defecte</li><li>Afegir la configuració nova a "<em>sites-available</em>"</li><li>Realitzar un link simbolic a "<em>sites-enabled</em>"</li></ol><details class="note"><summary>Codi amb bash</summary><pre><code>sudo apt-get install nginx
sudo rm /etc/nginx/sites-enabled/default
sudo cp /.../pygrn_xerrada_ansible/taller/docs_nginx.conf /etc/nginx/sites-available/docs
sudo ln -s /etc/nginx/sites-available/docs /etc/nginx/sites-enabled/docs
</code></pre><div class="admonition warning"><p class="admonition-title">Warning</p><p>Com que utilitzem fitxers protegits cal utilitzar <strong>sudo</strong>!</p></div></details><details class="tip"><summary>Mòduls que ens poden ajudar</summary><ul><li>APT</li><li>File</li><li>Copy</li></ul></details></details><div class="admonition info">
<p class="admonition-title">Info</p>
<p>No cal que compilem, utilitzem el mateix que podria venir amb un debian amb els repositoris de APT.</p>
</div>
<h3 id="clonar-el-repositori">Clonar el repositori</h3>
<p>Aquesta documentació es troba en el repositori de github de la xerrada: <a href="https://github.com/ytturi/pygrn_xerrada_ansible">github:ytturi/pygrn_xerrada_ansible</a>.</p>
<p>Allà hi tenim el directori "<code>taller/documentacio_estatica</code>" on trobarem:</p>
<ul>
<li>El fitxer de configuració de mkdocs ("mkdocs.yml"),</li>
<li>Els requeriments de pyhton ("requirements.txt") </li>
<li>La documentació en format Markdown en el directori "docs".</li>
</ul>
<details class="note"><summary>Passes que realitzariem en local</summary><ol><li>Anar al directori de projectes</li><li>Mirar si existeix el repositori<ol><li>Si no hi és el clonem amb <code>git clone https://github.com/ytturi/pygrn_xerrada_ansible.git</code></li><li>Si hi és, l'actualitzem amb <code>git pull</code></li></ol></li></ol><details class="tip"><summary>Mòduls que ens poden ajudar</summary><ul><li>GIT</li></ul></details></details><h3 id="configurar-python">Configurar Python</h3>
<p>Volem utilitzar MkDocs per realitzar el render de la pàgina. 
Però com fem (o hauriem de fer) amb la resta de projectes que treballem,
és millor instalar els requeriments en un virtualenv.</p>
<p>Per aquest motiu, el que farem serà utilitzar un virtualenv on hi instalarem els requeriments del repositori.</p>
<details class="note"><summary>Passes que realitzariem en local</summary><ol><li>Mirar si existeix la carpeta del virtualenv i activar-lo<ol><li>Si no existeix, en creem un de nou</li></ol></li><li>Anar a la carpeta del projecte</li><li>Instalar els requeriments del projecte (del fitxer requirements.txt)</li></ol><details class="tip"><summary>Mòduls que ens poden ajudar</summary><ul><li>PIP</li></ul></details></details><h3 id="build-de-la-documentacio">Build de la documentació</h3>
<p>Una vegada tenim l'entorn preparat, hem de realitzar build de la documentació per servir-la.
Realitzarem el build executant la comanda <code>mkdocs build -d "../built_docs"</code> des del virtualenv anterior.</p>
<details class="tip"><summary>Executar una comanda des d'un virtualenv sense ser-hi</summary><p>Per tal d'executar una comanda des d'un virtualenv en una sola línia podem cridar-la utilitzant
tot el <em>path</em> del virtualenv.</p><p>Per exemple si tenim el virtualenv en el directori: <code>/home/usuari/.virtualenvs/documentacio</code></p><p>Podem utilitzar: <code>/home/usuari/.virtualenvs/documentacio/bin/mkdocs</code></p></details><details class="question"><summary>Sempre cal fer build de la documentació?</summary><p>No sempre cal fer build. Però en el repositori tenim Markdown, i els fitxers a servir són HTML.</p><p>Com sabem si s'han modificat?</p><p>Aquests casos són més difícils de tractar, pel que millor fem build cada vegada.</p></details><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Per tal de tocar més funcionalitats d'Ansible, com els condicionals i els "register", 
afegirem la següent condició en aquest pas:</p>
<ul>
<li>Si ja teniem el repositori clonat i no s'ha d'actualitzar</li>
</ul>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Si no ho heu fet fins ara, sería interessant que utilitzessiu variables per els directoris afectats:</p>
<ul>
<li>Virtualenv</li>
<li>Documentació</li>
<li>HTML</li>
</ul>
<p>Si ho feu, podreu executar la comanda utilitzant-les, com ara:</p>
<p><code>{{ venv }}/bin/mkdocs build -c {{ docs }}/mkdocs.yml  -d {{ projectes }}/built_docs</code></p>
</div>
<details class="note"><summary>Passes que realitzariem en local</summary><ol><li>En el pas de "<a href="#clonar-el-repositori">Clonar el repositori</a>" ja sabrem si s'ha actualitzat o
   ha canviat algun fitxer del repositori. Si no ha canviat res, no farem aquest pas.</li><li>Realitzarem el build executant la comanda <code>mkdocs build -d "../built_docs"</code></li></ol><details class="tip"><summary>Mòduls que ens poden ajudar</summary><ul><li>SCRIPT</li><li>SHELL</li><li>COMMAND</li></ul></details></details><h3 id="actualitzacio-dels-fitxers-a-servir">Actualització dels fitxers a servir</h3>
<p>Aquesta part és la més senzilla. Com que tot ho servim via Nginx,
símplement cal que els fitxers a servir es modifiquin.</p>
<p>Ho podem fer de varies maneres:</p>
<ul>
<li>Després de fer build, movem o copiem els fitxers en el directori que serveix el NginX.</li>
<li>Podem assegurar-nos de que hi ha un link de la carpeta dels fitxers a la carpeta que serveix NginX.</li>
</ul>
<details class="tip"><summary>Mòduls que us poden ajudar</summary><ul><li>FILE</li><li>COMMAND</li></ul></details>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../README/" title="Informació i Ajuda" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Informació i Ajuda
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - Jaume Flórez Valenzuela
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/ytturi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="t.me/pygrn" class="md-footer-social__link fa fa-telegram"></a>
    
      <a href="https://twitter.com/PythonGirona" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/pygrn" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>